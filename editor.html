<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>편집 - 쇼츠 퀵에디터</title>
    <link rel="stylesheet" href="css/editor.css">
</head>
<body>
    <!-- 상단 네비게이션 -->
    <div id="navbar">
        <button onclick="goHome()">🏠 홈</button>
        <button onclick="openAdmin()">⚙️ 관리자</button>
        <button onclick="saveProject()">💾 저장</button>
        <div id="project-title">프로젝트: 테스트 프로젝트</div>
    </div>
    
    <!-- 메인 편집 영역 -->
    <div id="main-editor">
        <!-- 캔버스 영역 -->
        <div id="canvas-area">
            <div id="canvas" ondrop="dropOnCanvas(event)" ondragover="allowDrop(event)">
                <!-- 편집 요소들이 여기에 추가됨 -->
            </div>
        </div>
        
        <!-- PPT 편집기 -->
        <div id="ppt-editor">
            <div id="ppt-header">🎨 편집 도구</div>
            <div id="ppt-content">
                
                <!-- 기본 도구들 (항상 표시) -->
                <div class="ppt-section">
                    <h4>빠른 추가</h4>
                    <div class="button-group">
                        <button onclick="addQuickText()">📝 텍스트</button>
                        <button onclick="addQuickImage()">🖼️ 이미지</button>
                    </div>
                    <div class="button-group" style="margin-top: 5px;">
                        <button onclick="addQuickShape('circle')">⭕ 원</button>
                        <button onclick="addQuickShape('rectangle')">⬜ 사각형</button>
                    </div>
                </div>

                <div class="ppt-section">
                    <h4>배경</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 10px;">
                        <button onclick="changeBackground('#000000')" style="background: #000; color: white; padding: 8px; border: none; border-radius: 4px; cursor: pointer;">⚫</button>
                        <button onclick="changeBackground('#ffffff')" style="background: #fff; color: #000; padding: 8px; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">⚪</button>
                        <button onclick="changeBackground('linear-gradient(135deg, #667eea 0%, #764ba2 100%)')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px; border: none; border-radius: 4px; cursor: pointer;">🌅</button>
                        <button onclick="changeBackground('linear-gradient(135deg, #f093fb 0%, #f5576c 100%)')" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 8px; border: none; border-radius: 4px; cursor: pointer;">🌺</button>
                    </div>
                    <div class="ppt-control">
                        <label>커스텀 색상</label>
                        <input type="color" id="bg-color" onchange="changeBackground(this.value)" value="#667eea">
                    </div>
                </div>

                <div class="ppt-section">
                    <h4>레이어 관리</h4>
                    <div class="button-group">
                        <button onclick="bringToFront()">🔤 맨앞으로</button>
                        <button onclick="sendToBack()">🔥 맨뒤로</button>
                    </div>
                    <div class="button-group" style="margin-top: 5px;">
                        <button onclick="moveForward()">⬆️ 앞으로</button>
                        <button onclick="moveBackward()">⬇️ 뒤로</button>
                    </div>
                </div>

                <div class="ppt-section">
                    <h4>정렬</h4>
                    <div class="button-group">
                        <button onclick="alignLeft()">⬅️ 왼쪽</button>
                        <button onclick="alignCenter()">↔️ 가운데</button>
                        <button onclick="alignRight()">➡️ 오른쪽</button>
                    </div>
                    <div class="button-group" style="margin-top: 5px;">
                        <button onclick="alignTop()">⬆️ 위</button>
                        <button onclick="alignMiddle()">↕️ 중간</button>
                        <button onclick="alignBottom()">⬇️ 아래</button>
                    </div>
                </div>

                <!-- 텍스트 편집 (선택시 표시) -->
                <div id="text-editor" style="display: none;">
                    <div class="ppt-section">
                        <h4>📝 텍스트 편집</h4>
                        <div class="ppt-control">
                            <textarea id="text-content" rows="3" placeholder="텍스트를 입력하세요" style="width: 100%; padding: 8px; background: #404040; border: 1px solid #555; border-radius: 4px; color: white; font-size: 12px; resize: vertical;"></textarea>
                        </div>
                    </div>
                    
                    <div class="ppt-section">
                        <h4>글꼴 스타일</h4>
                        <div class="ppt-control">
                            <label>크기</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="text-size" min="12" max="72" value="16" style="flex: 1;">
                                <span id="text-size-value" style="min-width: 40px; color: #ccc;">16px</span>
                            </div>
                        </div>
                        <div class="ppt-control">
                            <label>색상</label>
                            <input type="color" id="text-color" value="#ffffff" style="width: 100%; height: 35px;">
                        </div>
                        <div class="ppt-control">
                            <label>글꼴</label>
                            <select id="text-font" style="width: 100%; padding: 8px; background: #404040; border: 1px solid #555; border-radius: 4px; color: white;">
                                <option value="Arial">Arial</option>
                                <option value="맑은 고딕">맑은 고딕</option>
                                <option value="나눔고딕">나눔고딕</option>
                                <option value="Times New Roman">Times New Roman</option>
                                <option value="Courier New">Courier New</option>
                            </select>
                        </div>
                        <div class="button-group">
                            <button id="bold-btn" onclick="toggleTextBold()">🔤 굵게</button>
                            <button id="italic-btn" onclick="toggleTextItalic()">🔖 기울임</button>
                            <button id="underline-btn" onclick="toggleTextUnderline()">🔒 밑줄</button>
                        </div>
                    </div>
                    
                    <div class="ppt-section">
                        <h4>텍스트 정렬</h4>
                        <div class="button-group">
                            <button onclick="setTextAlign('left')">⬅️ 왼쪽</button>
                            <button onclick="setTextAlign('center')">↔️ 가운데</button>
                            <button onclick="setTextAlign('right')">➡️ 오른쪽</button>
                        </div>
                    </div>
                    
                    <div class="ppt-section">
                        <h4>위치 조정</h4>
                        <div style="display: flex; gap: 10px;">
                            <div class="ppt-control" style="flex: 1;">
                                <label>X</label>
                                <input type="number" id="text-x" min="0" max="300" style="width: 100%; padding: 6px; background: #404040; border: 1px solid #555; border-radius: 4px; color: white;">
                            </div>
                            <div class="ppt-control" style="flex: 1;">
                                <label>Y</label>
                                <input type="number" id="text-y" min="0" max="500" style="width: 100%; padding: 6px; background: #404040; border: 1px solid #555; border-radius: 4px; color: white;">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 이미지 편집 (선택시 표시) -->
                <div id="image-editor" style="display: none;">
                    <div class="ppt-section">
                        <h4>🖼️ 이미지 편집</h4>
                        <div class="ppt-control">
                            <label>너비</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="image-width" min="50" max="280" value="150" style="flex: 1;">
                                <span id="image-width-value" style="min-width: 50px; color: #ccc;">150px</span>
                            </div>
                        </div>
                        <div class="ppt-control">
                            <label>높이</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="image-height" min="50" max="450" value="150" style="flex: 1;">
                                <span id="image-height-value" style="min-width: 50px; color: #ccc;">150px</span>
                            </div>
                        </div>
                        <div class="button-group">
                            <button id="lock-ratio-btn" onclick="toggleAspectRatio()">🔒 비율고정</button>
                            <button onclick="resetImageSize()">↩️ 원래크기</button>
                        </div>
                    </div>
                    
                    <div class="ppt-section">
                        <h4>이미지 효과</h4>
                        <div class="ppt-control">
                            <label>투명도</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="image-opacity" min="0" max="100" value="100" style="flex: 1;">
                                <span id="image-opacity-value" style="min-width: 40px; color: #ccc;">100%</span>
                            </div>
                        </div>
                        <div class="ppt-control">
                            <label>회전</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="image-rotation" min="0" max="360" value="0" style="flex: 1;">
                                <span id="image-rotation-value" style="min-width: 40px; color: #ccc;">0°</span>
                            </div>
                        </div>
                        <div class="button-group">
                            <button onclick="flipImageH()">↔️ 좌우뒤집기</button>
                            <button onclick="flipImageV()">↕️ 상하뒤집기</button>
                        </div>
                        <div class="button-group" style="margin-top: 5px;">
                            <button onclick="rotateImage(90)">↻ 90° 회전</button>
                            <button onclick="rotateImage(-90)">↺ -90° 회전</button>
                        </div>
                    </div>
                    
                    <div class="ppt-section">
                        <h4>이미지 필터</h4>
                        <div class="button-group">
                            <button onclick="applyImageFilter('none')">🔄 원본</button>
                            <button onclick="applyImageFilter('grayscale')">⚫ 흑백</button>
                        </div>
                        <div class="button-group" style="margin-top: 5px;">
                            <button onclick="applyImageFilter('sepia')">🟤 세피아</button>
                            <button onclick="applyImageFilter('blur')">🌫️ 블러</button>
                        </div>
                    </div>
                    
                    <div class="ppt-section">
                        <h4>위치 조정</h4>
                        <div style="display: flex; gap: 10px;">
                            <div class="ppt-control" style="flex: 1;">
                                <label>X</label>
                                <input type="number" id="image-x" min="0" max="300" style="width: 100%; padding: 6px; background: #404040; border: 1px solid #555; border-radius: 4px; color: white;">
                            </div>
                            <div class="ppt-control" style="flex: 1;">
                                <label>Y</label>
                                <input type="number" id="image-y" min="0" max="500" style="width: 100%; padding: 6px; background: #404040; border: 1px solid #555; border-radius: 4px; color: white;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 선택된 요소 공통 도구 -->
                <div id="selected-tools" style="display: none;">
                    <div class="ppt-section">
                        <h4>🎯 선택된 요소</h4>
                        <div class="button-group">
                            <button onclick="copySelectedElement()">📋 복사</button>
                            <button onclick="duplicateElement()">📑 복제</button>
                        </div>
                        <div class="button-group" style="margin-top: 5px;">
                            <button onclick="groupElements()">🔗 그룹</button>
                            <button onclick="deleteSelectedElement()">🗑️ 삭제</button>
                        </div>
                    </div>
                </div>

                <!-- 전체 캔버스 도구 -->
                <div class="ppt-section">
                    <h4>캔버스 설정</h4>
                    <div class="button-group">
                        <button onclick="clearCanvas()">🗑️ 전체삭제</button>
                        <button onclick="resetCanvas()">↩️ 초기화</button>
                    </div>
                    <div class="ppt-control" style="margin-top: 10px;">
                        <label>확대/축소</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <button onclick="zoomOut()" style="padding: 5px 10px; background: #555; border: none; color: white; border-radius: 3px; cursor: pointer;">➖</button>
                            <span id="zoom-level" style="color: #ccc; min-width: 50px; text-align: center;">100%</span>
                            <button onclick="zoomIn()" style="padding: 5px 10px; background: #555; border: none; color: white; border-radius: 3px; cursor: pointer;">➕</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 소스 패널 -->
        <div id="source-panel">
            <div id="source-tabs">
                <button class="source-tab active" onclick="switchTab('media')">📁<br>미디어</button>
                <button class="source-tab" onclick="switchTab('text')">📝<br>텍스트</button>
                <button class="source-tab" onclick="switchTab('audio')">🎵<br>음성</button>
                <button class="source-tab" onclick="switchTab('template')">🎨<br>템플릿</button>
            </div>
            
            <div id="source-content">
                <!-- 미디어 소스 -->
                <div id="media-sources" class="source-section active">
                    <div class="source-item" draggable="true" ondragstart="dragStart(event)" data-type="image" data-src="https://via.placeholder.com/200x150/4A90E2/white?text=샘플+이미지">
                        <div class="source-item-title">📷 샘플 이미지</div>
                        <div class="source-item-desc">드래그해서 캔버스에 추가</div>
                    </div>
                    
                    <div class="source-item" draggable="true" ondragstart="dragStart(event)" data-type="image" data-src="https://via.placeholder.com/200x150/E74C3C/white?text=로고">
                        <div class="source-item-title">🏷️ 로고</div>
                        <div class="source-item-desc">브랜드 로고 이미지</div>
                    </div>
                    
                    <div class="source-item">
                        <div class="source-item-title">📤 직접 업로드</div>
                        <input type="file" accept="image/*,video/*" onchange="uploadFile(this)" style="width: 100%; margin-top: 5px; font-size: 11px;">
                    </div>
                    
                    <div class="source-item">
                        <div class="source-item-title">🌐 무료 스톡</div>
                        <div class="source-item-desc">API로 무료 이미지 검색</div>
                        <input type="text" placeholder="검색어 입력" id="stock-search" style="width: 100%; margin-top: 5px; padding: 5px; background: #555; border: none; color: white; border-radius: 3px;">
                        <button onclick="searchStockImages()" style="width: 100%; margin-top: 5px; padding: 5px; background: #0066cc; border: none; color: white; border-radius: 3px; cursor: pointer;">검색</button>
                    </div>
                    
                    <div class="source-item">
                        <div class="source-item-title">🎨 AI 이미지 생성</div>
                        <div class="source-item-desc">AI로 이미지 생성</div>
                        <textarea placeholder="생성할 이미지 설명" id="ai-image-prompt" style="width: 100%; margin-top: 5px; padding: 5px; background: #555; border: none; color: white; border-radius: 3px; resize: none;" rows="2"></textarea>
                        <button onclick="generateAIImage()" style="width: 100%; margin-top: 5px; padding: 5px; background: #9b59b6; border: none; color: white; border-radius: 3px; cursor: pointer;">생성</button>
                    </div>
                </div>
                
                <!-- 텍스트 소스 -->
                <div id="text-sources" class="source-section">
                    <div class="source-item" draggable="true" ondragstart="dragStart(event)" data-type="text" data-content="제목 텍스트">
                        <div class="source-item-title">📝 제목</div>
                        <div class="source-item-desc">메인 제목용 텍스트</div>
                    </div>
                    
                    <div class="source-item" draggable="true" ondragstart="dragStart(event)" data-type="text" data-content="설명 텍스트">
                        <div class="source-item-title">💬 설명</div>
                        <div class="source-item-desc">부제목이나 설명용</div>
                    </div>
                    
                    <div class="source-item" draggable="true" ondragstart="dragStart(event)" data-type="text" data-content="클릭하세요!">
                        <div class="source-item-title">🎯 CTA</div>
                        <div class="source-item-desc">행동 유도 메시지</div>
                    </div>
                    
                    <div class="source-item">
                        <div class="source-item-title">✏️ 커스텀 텍스트</div>
                        <input type="text" placeholder="텍스트 입력" id="custom-text" style="width: 100%; margin-top: 5px;">
                        <button onclick="addCustomText()" style="width: 100%; margin-top: 5px; padding: 5px; background: #0066cc; border: none; color: white; border-radius: 3px; cursor: pointer;">추가</button>
                    </div>
                    
                    <div class="source-item">
                        <div class="source-item-title">📜 대본 작성</div>
                        <div class="source-item-desc">동영상 대본</div>
                        <div class="button-group">
                            <button onclick="showScriptEditor('manual')">직접작성</button>
                            <button onclick="showScriptEditor('ai')">AI작성</button>
                        </div>
                    </div>
                    
                    <div class="source-item">
                        <div class="source-item-title">🎙️ 나레이션</div>
                        <div class="source-item-desc">음성 대본</div>
                        <div class="button-group">
                            <button onclick="showNarrationEditor('manual')">직접작성</button>
                            <button onclick="showNarrationEditor('ai')">AI작성</button>
                        </div>
                    </div>
                </div>
                
                <!-- 음성 소스 -->
                <div id="audio-sources" class="source-section">
                    <div class="source-item">
                        <div class="source-item-title">🎵 배경음악</div>
                        <div class="source-item-desc">프로젝트 배경음악 설정</div>
                        <input type="file" accept="audio/*" onchange="uploadBGM(this)" style="width: 100%; margin-top: 5px; font-size: 11px;">
                    </div>
                    
                    <div class="source-item">
                        <div class="source-item-title">📤 음성파일 업로드</div>
                        <div class="source-item-desc">나레이션, 대사 등</div>
                        <input type="file" accept="audio/*" onchange="uploadAudio(this)" style="width: 100%; margin-top: 5px; font-size: 11px;">
                    </div>
                    
                    <div class="source-item">
                        <div class="source-item-title">📊 보유 효과음</div>
                        <div class="source-item-desc">업로드한 효과음 선택</div>
                        <select id="owned-sfx" onchange="selectOwnedSFX()" style="width: 100%; margin-top: 5px;">
                            <option value="">효과음 선택</option>
                            <option value="click">클릭 소리</option>
                            <option value="whoosh">움직임 소리</option>
                            <option value="ding">알림음</option>
                        </select>
                        <input type="file" accept="audio/*" onchange="uploadSFX(this)" style="width: 100%; margin-top: 5px; font-size: 11px;" placeholder="새 효과음 추가">
                    </div>
                    
                    <div class="source-item">
                        <div class="source-item-title">🌐 무료 효과음</div>
                        <div class="source-item-desc">API로 무료 효과음 검색</div>
                        <input type="text" placeholder="효과음 검색 (예: 박수, 폭발)" id="sfx-search" style="width: 100%; margin-top: 5px; padding: 5px; background: #555; border: none; color: white; border-radius: 3px;">
                        <button onclick="searchFreeSFX()" style="width: 100%; margin-top: 5px; padding: 5px; background: #0066cc; border: none; color: white; border-radius: 3px; cursor: pointer;">검색</button>
                    </div>
                    
                    <div class="source-item">
                        <div class="source-item-title">🎙️ 음성 녹음</div>
                        <div class="source-item-desc">실시간 녹음</div>
                        <div class="button-group">
                            <button onclick="startRecording()">🔴 녹음</button>
                            <button onclick="stopRecording()">⏹️ 정지</button>
                        </div>
                    </div>
                </div>
                
                <!-- 템플릿 소스 -->
                <div id="template-sources" class="source-section">
                    <!-- templates/template-panel.html 내용이 여기에 로드됩니다 -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript 파일들 로드 -->
    <script src="js/utils.js"></script>
    <script src="js/canvas.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/tabs.js"></script>
    <script src="js/dragdrop.js"></script>
    <script src="js/editor.js"></script>
    <script src="js/media.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/text.js"></script>
    <script src="js/template.js"></script>
    <script src="js/init.js"></script>
    
    <script>
        // PPT 편집기 템플릿 로드
        fetch('templates/ppt-editor.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('ppt-editor').innerHTML = html;
            })
            .catch(error => console.error('PPT 편집기 로드 실패:', error));

        // 템플릿 패널 로드
        fetch('templates/template-panel.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('template-sources').innerHTML = html;
            })
            .catch(error => console.error('템플릿 패널 로드 실패:', error));
    </script>
</body>
</html>
