<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>편집 - 쇼츠 퀵에디터</title>
    <link rel="stylesheet" href="css/editor.css">
    <style>
        /* 캔버스 영역 내부만 위아래 배치 */
        #canvas-area {
            display: flex;
            flex-direction: column;
        }
        
        /* 플레이어 모드 전환 버튼 스타일 */
        .mode-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        
        .mode-btn {
            padding: 10px 20px;
            border: 2px solid #555;
            background: #404040;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .mode-btn:hover {
            background: #555;
            border-color: #007bff;
        }
        
        .mode-btn.active {
            background: #007bff;
            border-color: #0056b3;
            color: white;
        }
        
        /* 플레이어 컨트롤 스타일 */
        .player-controls {
            display: none;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .control-bar {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .play-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: #007bff;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stop-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 6px;
            background: #dc3545;
            color: white;
            font-size: 14px;
            cursor: pointer;
        }
        
        .time-display {
            color: white;
            font-family: monospace;
            font-size: 14px;
            min-width: 100px;
        }
        
        .timeline-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .timeline-slider {
            flex: 1;
            height: 8px;
            background: #404040;
            border-radius: 4px;
            outline: none;
            cursor: pointer;
        }
        
        .speed-control {
            background: #404040;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px;
            cursor: pointer;
        }
        
        .volume-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .volume-slider {
            width: 100px;
            height: 6px;
            background: #404040;
            border-radius: 3px;
            outline: none;
            cursor: pointer;
        }
        
        .volume-value {
            color: #ccc;
            font-size: 12px;
            min-width: 40px;
        }
        
        .player-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            padding-top: 15px;
            border-top: 1px solid #444;
        }
        
        .option-btn {
            padding: 8px 15px;
            background: #555;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .render-btn {
            background: #28a745;
            font-weight: bold;
        }
        
        /* 플레이어 모드일 때 캔버스 스타일 */
        .canvas-player-mode {
            aspect-ratio: 9/16;
            max-width: 300px;
            max-height: 533px;
            margin: 0 auto;
            border: 2px solid #007bff;
        }

        /* 검색 결과 스타일 */
        .search-result-item {
            display: flex;
            margin: 5px 0;
            padding: 5px;
            background: #404040;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .search-result-item:hover {
            background: #555;
        }
        
        .search-result-thumbnail {
            width: 60px;
            height: 40px;
            object-fit: cover;
            border-radius: 3px;
            margin-right: 8px;
        }
        
        .search-result-info {
            flex: 1;
            color: white;
            font-size: 11px;
        }
        
        .search-result-title {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .search-result-source {
            color: #ccc;
            font-size: 10px;
        }

        /* AI 모델 선택 스타일 */
        .model-selector {
            margin-bottom: 8px;
        }
        
        .model-selector select {
            width: 100%;
            padding: 5px;
            background: #555;
            border: 1px solid #666;
            color: white;
            border-radius: 3px;
            font-size: 11px;
        }
        
        .model-selector label {
            display: block;
            color: #ccc;
            font-size: 10px;
            margin-bottom: 3px;
        }

        /* AI 생성 섹션 구분 */
        .ai-generation-section {
            border: 1px solid #444;
            border-radius: 6px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        
        .ai-section-header {
            background: #3a3a3a;
            padding: 8px 10px;
            color: #fff;
            font-weight: bold;
            font-size: 12px;
            border-bottom: 1px solid #444;
        }
        
        .ai-section-content {
            padding: 10px;
        }
    </style>
</head>
<body>
    <!-- 상단 네비게이션 -->
    <div id="navbar">
        <button onclick="goHome()">🏠 홈</button>
        <button onclick="openAdmin()">⚙️ 관리자</button>
        <button onclick="saveProject()">💾 저장</button>
        <div id="project-title">프로젝트: 테스트 프로젝트</div>
    </div>
    
    <!-- 메인 편집 영역 -->
    <div id="main-editor">
        <!-- 캔버스 영역 -->
        <div id="canvas-area">
            <!-- 모드 전환 버튼 -->
            <div class="mode-controls">
                <button id="edit-mode-btn" class="mode-btn active" onclick="switchToEditMode()">
                    ✏️ 편집 모드
                </button>
                <button id="player-mode-btn" class="mode-btn" onclick="switchToPlayerMode()">
                    ▶️ 플레이어 모드
                </button>
            </div>
            
            <!-- 캔버스 -->
            <div id="canvas" ondrop="dropOnCanvas(event)" ondragover="allowDrop(event)">
                <!-- 편집 요소들이 여기에 추가됨 -->
            </div>
            
            <!-- 플레이어 컨트롤 -->
            <div id="player-controls" class="player-controls">
                <!-- 메인 컨트롤 바 -->
                <div class="control-bar">
                    <button id="play-pause-btn" class="play-btn" onclick="togglePlayPause()">▶️</button>
                    <button class="stop-btn" onclick="stopPlayback()">⏹️</button>
                    <div id="time-display" class="time-display">00:00 / 01:00</div>
                </div>
                
                <!-- 타임라인 -->
                <div class="timeline-container">
                    <input type="range" id="timeline-slider" class="timeline-slider" 
                           min="0" max="60" value="0" oninput="seekTo(this.value)">
                    <select id="speed-control" class="speed-control" onchange="changePlaybackSpeed(this.value)">
                        <option value="0.5">0.5x</option>
                        <option value="1" selected>1.0x</option>
                        <option value="1.5">1.5x</option>
                        <option value="2">2.0x</option>
                    </select>
                </div>
                
                <!-- 볼륨 컨트롤 -->
                <div class="volume-container">
                    <span style="color: white;">🔊</span>
                    <input type="range" id="volume-slider" class="volume-slider" 
                           min="0" max="100" value="80" oninput="changeVolume(this.value)">
                    <span id="volume-value" class="volume-value">80%</span>
                </div>
                
                <!-- 플레이어 옵션 -->
                <div class="player-options">
                    <button id="loop-btn" class="option-btn" onclick="toggleLoop()">🔄 반복</button>
                    <button class="option-btn" onclick="toggleFullscreen()">⛶ 전체화면</button>
                    <button class="option-btn render-btn" onclick="renderVideo()">🎬 렌더링</button>
                </div>
            </div>
        </div>
        
        <!-- PPT 편집기 -->
        <div id="ppt-editor">
            <div id="ppt-header">🎨 편집 도구</div>
            <div id="ppt-content">
                
                <!-- 기본 도구들 (항상 표시) -->
                <div class="ppt-section">
                    <h4>빠른 추가</h4>
                    <div class="button-group">
                        <button onclick="addQuickText()">📝 텍스트</button>
                        <button onclick="addQuickImage()">🖼️ 이미지</button>
                    </div>
                    <div class="button-group" style="margin-top: 5px;">
                        <button onclick="addQuickShape('circle')">⭕ 원</button>
                        <button onclick="addQuickShape('rectangle')">⬜ 사각형</button>
                    </div>
                </div>

                <div class="ppt-section">
                    <h4>배경</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 10px;">
                        <button onclick="changeBackground('#000000')" style="background: #000; color: white; padding: 8px; border: none; border-radius: 4px; cursor: pointer;">⚫</button>
                        <button onclick="changeBackground('#ffffff')" style="background: #fff; color: #000; padding: 8px; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">⚪</button>
                        <button onclick="changeBackground('linear-gradient(135deg, #667eea 0%, #764ba2 100%)')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px; border: none; border-radius: 4px; cursor: pointer;">🌅</button>
                        <button onclick="changeBackground('linear-gradient(135deg, #f093fb 0%, #f5576c 100%)')" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 8px; border: none; border-radius: 4px; cursor: pointer;">🌺</button>
                    </div>
                    <div class="ppt-control">
                        <label>커스텀 색상</label>
                        <input type="color" id="bg-color" onchange="changeBackground(this.value)" value="#667eea">
                    </div>
                </div>

                <div class="ppt-section">
                    <h4>레이어 관리</h4>
                    <div class="button-group">
                        <button onclick="bringToFront()">📤 맨앞으로</button>
                        <button onclick="sendToBack()">📥 맨뒤로</button>
                    </div>
                    <div class="button-group" style="margin-top: 5px;">
                        <button onclick="moveForward()">⬆️ 앞으로</button>
                        <button onclick="moveBackward()">⬇️ 뒤로</button>
                    </div>
                </div>

                <div class="ppt-section">
                    <h4>정렬</h4>
                    <div class="button-group">
                        <button onclick="alignLeft()">⬅️ 왼쪽</button>
                        <button onclick="alignCenter()">↔️ 가운데</button>
                        <button onclick="alignRight()">➡️ 오른쪽</button>
                    </div>
                    <div class="button-group" style="margin-top: 5px;">
                        <button onclick="alignTop()">⬆️ 위</button>
                        <button onclick="alignMiddle()">↕️ 중간</button>
                        <button onclick="alignBottom()">⬇️ 아래</button>
                    </div>
                </div>

                <!-- 텍스트 편집 (선택시 표시) -->
                <div id="text-editor" style="display: none;">
                    <div class="ppt-section">
                        <h4>📝 텍스트 편집</h4>
                        <div class="ppt-control">
                            <label>텍스트 내용</label>
                            <textarea id="text-content" placeholder="텍스트를 입력하세요" 
                                     style="width: 100%; height: 60px; padding: 8px; background: #404040; border: 1px solid #555; border-radius: 4px; color: white; resize: vertical;"></textarea>
                        </div>
                        
                        <div class="ppt-control">
                            <label>폰트 크기</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="text-font-size" min="12" max="48" value="16" 
                                       oninput="updateTextFontSize(this.value)" style="flex: 1;">
                                <span id="text-font-size-value" style="min-width: 40px; color: #ccc;">16px</span>
                            </div>
                        </div>
                        
                        <!-- 🔥 새로 추가: 텍스트 박스 크기 조절 -->
                        <div class="ppt-control">
                            <label>텍스트 박스 너비</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="text-width" min="50" max="280" value="150" 
                                       oninput="updateTextWidth(this.value)" style="flex: 1;">
                                <span id="text-width-value" style="min-width: 50px; color: #ccc;">150px</span>
                            </div>
                        </div>
                        
                        <div class="ppt-control">
                            <label>텍스트 박스 높이</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="text-height" min="30" max="200" value="50" 
                                       oninput="updateTextHeight(this.value)" style="flex: 1;">
                                <span id="text-height-value" style="min-width: 50px; color: #ccc;">50px</span>
                            </div>
                        </div>
                        
                        <div class="ppt-control">
                            <label>글자 색상</label>
                            <input type="color" id="text-color" value="#ffffff" 
                                   onchange="updateTextColor(this.value)" style="width: 100%; height: 30px;">
                        </div>
                        
                        <div class="ppt-control">
                            <label>배경 색상</label>
                            <input type="color" id="text-bg-color" value="#000000" 
                                   onchange="updateTextBgColor(this.value)" style="width: 100%; height: 30px;">
                        </div>
                        
                        <div class="button-group">
                            <button id="text-bold-btn" onclick="toggleTextBold()">B</button>
                            <button id="text-italic-btn" onclick="toggleTextItalic()">I</button>
                            <button id="text-underline-btn" onclick="toggleTextUnderline()">U</button>
                        </div>
                        
                        <!-- 🔥 새로 추가: 텍스트 위치 조정 -->
                        <div class="ppt-control">
                            <label>위치 조정</label>
                            <div style="display: flex; gap: 10px;">
                                <div style="flex: 1;">
                                    <label style="font-size: 10px;">X</label>
                                    <input type="number" id="text-x" min="0" max="300" 
                                           onchange="updateTextPosition()" 
                                           style="width: 100%; padding: 4px; background: #404040; border: 1px solid #555; border-radius: 4px; color: white;">
                                </div>
                                <div style="flex: 1;">
                                    <label style="font-size: 10px;">Y</label>
                                    <input type="number" id="text-y" min="0" max="500" 
                                           onchange="updateTextPosition()" 
                                           style="width: 100%; padding: 4px; background: #404040; border: 1px solid #555; border-radius: 4px; color: white;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 이미지 편집 (선택시 표시) -->
                <div id="image-editor" style="display: none;">
                    <div class="ppt-section">
                        <h4>🖼️ 이미지 편집</h4>
                        <div class="ppt-control">
                            <label>너비</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="image-width" min="50" max="280" value="150" 
                                       oninput="updateImageWidth(this.value)" style="flex: 1;">
                                <span id="image-width-value" style="min-width: 50px; color: #ccc;">150px</span>
                            </div>
                        </div>
                        <div class="ppt-control">
                            <label>높이</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="image-height" min="50" max="450" value="150" 
                                       oninput="updateImageHeight(this.value)" style="flex: 1;">
                                <span id="image-height-value" style="min-width: 50px; color: #ccc;">150px</span>
                            </div>
                        </div>
                        <div class="button-group">
                            <button id="lock-ratio-btn" onclick="toggleAspectRatio()">🔒 비율고정</button>
                            <button onclick="resetImageSize()">↩️ 원래크기</button>
                        </div>
                        
                        <!-- 이미지 위치 조정 -->
                        <div class="ppt-control">
                            <label>위치 조정</label>
                            <div style="display: flex; gap: 10px;">
                                <div style="flex: 1;">
                                    <label style="font-size: 10px;">X</label>
                                    <input type="number" id="image-x" min="0" max="300" 
                                           onchange="updateImagePosition()" 
                                           style="width: 100%; padding: 4px; background: #404040; border: 1px solid #555; border-radius: 4px; color: white;">
                                </div>
                                <div style="flex: 1;">
                                    <label style="font-size: 10px;">Y</label>
                                    <input type="number" id="image-y" min="0" max="500" 
                                           onchange="updateImagePosition()" 
                                           style="width: 100%; padding: 4px; background: #404040; border: 1px solid #555; border-radius: 4px; color: white;">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ppt-section">
                        <h4>이미지 효과</h4>
                        <div class="ppt-control">
                            <label>투명도</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="image-opacity" min="0" max="100" value="100" 
                                       oninput="updateImageOpacity(this.value)" style="flex: 1;">
                                <span id="image-opacity-value" style="min-width: 40px; color: #ccc;">100%</span>
                            </div>
                        </div>
                        <div class="ppt-control">
                            <label>회전</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="image-rotation" min="0" max="360" value="0" 
                                       oninput="updateImageRotation(this.value)" style="flex: 1;">
                                <span id="image-rotation-value" style="min-width: 40px; color: #ccc;">0°</span>
                            </div>
                        </div>
                        <div class="button-group">
                            <button onclick="flipImageH()">↔️ 좌우뒤집기</button>
                            <button onclick="flipImageV()">↕️ 상하뒤집기</button>
                        </div>
                        <div class="button-group" style="margin-top: 5px;">
                            <button onclick="rotateImage(90)">↻ 90° 회전</button>
                            <button onclick="rotateImage(-90)">↺ -90° 회전</button>
                        </div>
                    </div>
                    
                    <div class="ppt-section">
                        <h4>이미지 필터</h4>
                        <div class="button-group">
                            <button onclick="applyImageFilter('none')">🔄 원본</button>
                            <button onclick="applyImageFilter('grayscale')">⚫ 흑백</button>
                        </div>
                        <div class="button-group" style="margin-top: 5px;">
                            <button onclick="applyImageFilter('sepia')">🟤 세피아</button>
                            <button onclick="applyImageFilter('blur')">🌫️ 블러</button>
                        </div>
                    </div>
                </div>

                <!-- 🔥 새로 추가: 도형 편집 (선택시 표시) -->
                <div id="shape-editor" style="display: none;">
                    <div class="ppt-section">
                        <h4>🔺 도형 편집</h4>
                        
                        <!-- 도형 크기 조절 -->
                        <div class="ppt-control">
                            <label>도형 너비</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="shape-width" min="20" max="280" value="120" 
                                       oninput="updateShapeWidth(this.value)" style="flex: 1;">
                                <span id="shape-width-value" style="min-width: 50px; color: #ccc;">120px</span>
                            </div>
                        </div>
                        
                        <div class="ppt-control">
                            <label>도형 높이</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="shape-height" min="20" max="200" value="80" 
                                       oninput="updateShapeHeight(this.value)" style="flex: 1;">
                                <span id="shape-height-value" style="min-width: 50px; color: #ccc;">80px</span>
                            </div>
                        </div>
                        
                        <div class="button-group">
                            <button id="shape-lock-ratio-btn" onclick="toggleShapeAspectRatio()">🔒 비율고정</button>
                            <button onclick="resetShapeSize()">↩️ 원래크기</button>
                        </div>
                        
                        <!-- 도형 위치 조정 -->
                        <div class="ppt-control">
                            <label>위치 조정</label>
                            <div style="display: flex; gap: 10px;">
                                <div style="flex: 1;">
                                    <label style="font-size: 10px;">X</label>
                                    <input type="number" id="shape-x" min="0" max="300" 
                                           onchange="updateShapePosition()" 
                                           style="width: 100%; padding: 4px; background: #404040; border: 1px solid #555; border-radius: 4px; color: white;">
                                </div>
                                <div style="flex: 1;">
                                    <label style="font-size: 10px;">Y</label>
                                    <input type="number" id="shape-y" min="0" max="500" 
                                           onchange="updateShapePosition()" 
                                           style="width: 100%; padding: 4px; background: #404040; border: 1px solid #555; border-radius: 4px; color: white;">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ppt-section">
                        <h4>도형 스타일</h4>
                        <div class="ppt-control">
                            <label>배경 색상</label>
                            <input type="color" id="shape-bg-color" value="#667eea" 
                                   onchange="updateShapeBgColor(this.value)" style="width: 100%; height: 30px;">
                        </div>
                        
                        <div class="ppt-control">
                            <label>테두리 색상</label>
                            <input type="color" id="shape-border-color" value="#333333" 
                                   onchange="updateShapeBorderColor(this.value)" style="width: 100%; height: 30px;">
                        </div>
                        
                        <div class="ppt-control">
                            <label>테두리 두께</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="shape-border-width" min="0" max="10" value="0" 
                                       oninput="updateShapeBorderWidth(this.value)" style="flex: 1;">
                                <span id="shape-border-width-value" style="min-width: 40px; color: #ccc;">0px</span>
                            </div>
                        </div>
                        
                        <div class="ppt-control">
                            <label>투명도</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="shape-opacity" min="0" max="100" value="100" 
                                       oninput="updateShapeOpacity(this.value)" style="flex: 1;">
                                <span id="shape-opacity-value" style="min-width: 40px; color: #ccc;">100%</span>
                            </div>
                        </div>
                        
                        <div class="ppt-control">
                            <label>회전</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="shape-rotation" min="0" max="360" value="0" 
                                       oninput="updateShapeRotation(this.value)" style="flex: 1;">
                                <span id="shape-rotation-value" style="min-width: 40px; color: #ccc;">0°</span>
                            </div>
                        </div>
                        
                        <div class="button-group">
                            <button onclick="rotateShape(90)">↻ 90° 회전</button>
                            <button onclick="rotateShape(-90)">↺ -90° 회전</button>
                        </div>
                    </div>
                </div>

                <!-- 선택된 요소 공통 도구 -->
                <div id="selected-tools" style="display: none;">
                    <div class="ppt-section">
                        <h4>🎯 선택된 요소</h4>
                        <div class="button-group">
                            <button onclick="copySelectedElement()">📋 복사</button>
                            <button onclick="duplicateElement()">📄 복제</button>
                        </div>
                        <div class="button-group" style="margin-top: 5px;">
                            <button onclick="groupElements()">🔗 그룹</button>
                            <button onclick="deleteSelectedElement()">🗑️ 삭제</button>
                        </div>
                    </div>
                </div>

                <!-- 전체 캔버스 도구 -->
                <div class="ppt-section">
                    <h4>캔버스 설정</h4>
                    <div class="button-group">
                        <button onclick="clearCanvas()">🗑️ 전체삭제</button>
                        <button onclick="resetCanvas()">↩️ 초기화</button>
                    </div>
                    <div class="ppt-control" style="margin-top: 10px;">
                        <label>확대/축소</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <button onclick="zoomOut()" style="padding: 5px 10px; background: #555; border: none; color: white; border-radius: 3px; cursor: pointer;">➖</button>
                            <span id="zoom-level" style="color: #ccc; min-width: 50px; text-align: center;">100%</span>
                            <button onclick="zoomIn()" style="padding: 5px 10px; background: #555; border: none; color: white; border-radius: 3px; cursor: pointer;">➕</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 소스 패널 -->
        <div id="source-panel">
            <div id="source-tabs">
                <button class="source-tab active" onclick="switchTab('media')">🖼<br>미디어</button>
                <button class="source-tab" onclick="switchTab('text')">📝<br>텍스트</button>
                <button class="source-tab" onclick="switchTab('audio')">🎵<br>음성</button>
                <button class="source-tab" onclick="switchTab('template')">🎨<br>템플릿</button>
            </div>
            
            <div id="source-content">
                <!-- 미디어 소스 -->
                <div id="media-sources" class="source-section active">
                    <div class="source-item">
                        <div class="source-item-title">📤 직접 업로드</div>
                        <input type="file" accept="image/*,video/*" onchange="uploadFile(this)" style="width: 100%; margin-top: 5px; font-size: 11px;">
                    </div>
                    
                    <div class="source-item">
                        <div class="source-item-title">🌐 무료 이미지</div>
                        <div class="source-item-desc">API로 무료 이미지 검색</div>
                        <input type="text" placeholder="검색어 입력" id="stock-image-search" style="width: 100%; margin-top: 5px; padding: 5px; background: #555; border: none; color: white; border-radius: 3px;">
                        <button onclick="searchStockImages()" style="width: 100%; margin-top: 5px; padding: 5px; background: #0066cc; border: none; color: white; border-radius: 3px; cursor: pointer;">이미지 검색</button>
                        <div id="image-search-results" style="margin-top: 10px;"></div>
                    </div>
                    
                    <div class="source-item">
                        <div class="source-item-title">🎬 무료 동영상</div>
                        <div class="source-item-desc">API로 무료 동영상 검색</div>
                        <input type="text" placeholder="검색어 입력" id="stock-video-search" style="width: 100%; margin-top: 5px; padding: 5px; background: #555; border: none; color: white; border-radius: 3px;">
                        <button onclick="searchStockVideos()" style="width: 100%; margin-top: 5px; padding: 5px; background: #0066cc; border: none; color: white; border-radius: 3px; cursor: pointer;">동영상 검색</button>
                        <div id="video-search-results" style="margin-top: 10px;"></div>
                    </div>
                    
                    <!-- 🔥 AI 생성 섹션들 - 모델 선택 포함 -->
                    
                    <!-- 1. 텍스트 → 이미지 생성 -->
                    <div class="ai-generation-section">
                        <div class="ai-section-header">🎨 AI 이미지 생성 (텍스트 → 이미지)</div>
                        <div class="ai-section-content">
                            <div class="model-selector">
                                <label>모델 선택</label>
                                <select id="text-to-image-model">
                                    <option value="fal-ai/flux/schnell">Flux Schnell (빠름)</option>
                                    <option value="fal-ai/flux/dev">Flux Dev (고품질)</option>
                                    <option value="fal-ai/stable-diffusion-v3-medium">Stable Diffusion v3</option>
                                    <option value="fal-ai/aura-flow">Aura Flow</option>
                                </select>
                            </div>
                            <textarea placeholder="생성할 이미지 설명&#10;예: A cozy coffee shop with warm lighting" id="ai-image-prompt" style="width: 100%; margin-top: 5px; padding: 5px; background: #555; border: none; color: white; border-radius: 3px; resize: none;" rows="2"></textarea>
                            <button onclick="generateAIImage()" style="width: 100%; margin-top: 5px; padding: 5px; background: #9b59b6; border: none; color: white; border-radius: 3px; cursor: pointer;">생성</button>
                            <div id="ai-image-result" style="margin-top: 10px;"></div>
                        </div>
                    </div>
                    
                    <!-- 2. 이미지 → 이미지 변환 -->
                    <div class="ai-generation-section">
                        <div class="ai-section-header">🔄 AI 이미지 변환 (이미지 → 이미지)</div>
                        <div class="ai-section-content">
                            <div class="model-selector">
                                <label>모델 선택</label>
                                <select id="image-to-image-model">
                                    <option value="fal-ai/flux/dev/image-to-image">Flux Dev (추천)</option>
                                    <option value="fal-ai/flux/schnell/image-to-image">Flux Schnell (빠름)</option>
                                    <option value="fal-ai/stable-diffusion-v3-medium/image-to-image">Stable Diffusion v3</option>
                                </select>
                            </div>
                            <input type="file" accept="image/*" id="ai-image-to-image-file" style="width: 100%; margin-top: 5px; font-size: 11px;">
                            <textarea placeholder="변환 설명&#10;예: make it look like a painting" id="ai-image-to-image-prompt" style="width: 100%; margin-top: 5px; padding: 5px; background: #555; border: none; color: white; border-radius: 3px; resize: none;" rows="2"></textarea>
                            <button onclick="generateImageToImage()" style="width: 100%; margin-top: 5px; padding: 5px; background: #e67e22; border: none; color: white; border-radius: 3px; cursor: pointer;">변환</button>
                            <div id="ai-image-to-image-result" style="margin-top: 10px;"></div>
                        </div>
                    </div>
                    
                    <!-- 3. 텍스트 → 동영상 생성 -->
                    <div class="ai-generation-section">
                        <div class="ai-section-header">🎬 AI 동영상 생성 (텍스트 → 동영상)</div>
                        <div class="ai-section-content">
                            <div class="model-selector">
                                <label>모델 선택</label>
                                <select id="text-to-video-model">
                                    <option value="fal-ai/luma-dream-machine">Luma Dream Machine (추천)</option>
                                    <option value="fal-ai/runway-gen3">Runway Gen3</option>
                                    <option value="fal-ai/stable-video">Stable Video</option>
                                </select>
                            </div>
                            <textarea placeholder="동영상 설명&#10;예: A person walking in a beautiful garden" id="ai-text-to-video-prompt" style="width: 100%; margin-top: 5px; padding: 5px; background: #555; border: none; color: white; border-radius: 3px; resize: none;" rows="2"></textarea>
                            <button onclick="generateTextToVideo()" style="width: 100%; margin-top: 5px; padding: 5px; background: #2980b9; border: none; color: white; border-radius: 3px; cursor: pointer;">생성 (1-3분)</button>
                            <div id="ai-text-to-video-result" style="margin-top: 10px;"></div>
                        </div>
                    </div>
                    
                    <!-- 4. 이미지 → 동영상 생성 -->
                    <div class="ai-generation-section">
                        <div class="ai-section-header">📹 AI 이미지 애니메이션 (이미지 → 동영상)</div>
                        <div class="ai-section-content">
                            <div class="model-selector">
                                <label>모델 선택</label>
                                <select id="image-to-video-model">
                                    <option value="fal-ai/luma-dream-machine">Luma Dream Machine (추천)</option>
                                    <option value="fal-ai/runway-gen3">Runway Gen3</option>
                                    <option value="fal-ai/stable-video">Stable Video</option>
                                </select>
                            </div>
                            <input type="file" accept="image/*" id="ai-image-to-video-file" style="width: 100%; margin-top: 5px; font-size: 11px;">
                            <textarea placeholder="애니메이션 설명 (선택사항)&#10;예: animate this image smoothly" id="ai-image-to-video-prompt" style="width: 100%; margin-top: 5px; padding: 5px; background: #555; border: none; color: white; border-radius: 3px; resize: none;" rows="2"></textarea>
                            <button onclick="generateImageToVideo()" style="width: 100%; margin-top: 5px; padding: 5px; background: #27ae60; border: none; color: white; border-radius: 3px; cursor: pointer;">애니메이션 (1-3분)</button>
                            <div id="ai-image-to-video-result" style="margin-top: 10px;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- 텍스트 소스 -->
                <div id="text-sources" class="source-section">
                    <div class="source-item" draggable="true" ondragstart="dragStart(event)" data-type="text" data-content="제목 텍스트">
                        <div class="source-item-title">📝 제목</div>
                        <div class="source-item-desc">메인 제목용 텍스트</div>
                    </div>
                    
                    <div class="source-item" draggable="true" ondragstart="dragStart(event)" data-type="text" data-content="설명 텍스트">
                        <div class="source-item-title">💬 설명</div>
                        <div class="source-item-desc">부제목이나 설명용</div>
                    </div>
                    
                    <div class="source-item" draggable="true" ondragstart="dragStart(event)" data-type="text" data-content="클릭하세요!">
                        <div class="source-item-title">🎯 CTA</div>
                        <div class="source-item-desc">행동 유도 메시지</div>
                    </div>
                    
                    <div class="source-item">
                        <div class="source-item-title">📜 대본 작성</div>
                        <div class="source-item-desc">동영상 대본</div>
                        <div class="button-group">
                            <button onclick="showScriptEditor('manual')">직접작성</button>
                            <button onclick="showScriptEditor('ai')">AI작성</button>
                        </div>
                    </div>
                    
                    <div class="source-item">
                        <div class="source-item-title">🎙️ 나레이션</div>
                        <div class="source-item-desc">음성 대본</div>
                        <div class="button-group">
                            <button onclick="showNarrationEditor('manual')">직접작성</button>
                            <button onclick="showNarrationEditor('ai')">AI작성</button>
                        </div>
                    </div>
                </div>
                
                <!-- 음성 소스 -->
                <div id="audio-sources" class="source-section">
                    <!-- templates/audio-panel.html 내용이 여기에 로드됩니다 -->
                </div>
                
                <!-- 템플릿 소스 -->
                <div id="template-sources" class="source-section">
                    <!-- templates/template-panel.html 내용이 여기에 로드됩니다 -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript 파일들 로드 -->
    <script src="js/utils.js"></script>
    <script src="js/canvas.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/tabs.js"></script>
    <script src="js/dragdrop.js"></script>
    <script src="js/editor.js"></script>
    <script src="js/media.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/text.js"></script>
    <script src="js/template.js"></script>
    <script src="js/init.js"></script>
    
    <script>
        // ========== 🔥 텍스트 크기 조절 함수들 (새로 추가) ==========
        function updateTextWidth(width) {
            if (!selectedElement || !selectedElement.classList.contains('canvas-text')) return;
            
            selectedElement.style.width = width + 'px';
            document.getElementById('text-width-value').textContent = width + 'px';
            
            // 리사이즈 핸들 업데이트
            if (typeof updateResizeHandles === 'function') {
                updateResizeHandles();
            }
            
            saveCanvasState();
        }
        
        function updateTextHeight(height) {
            if (!selectedElement || !selectedElement.classList.contains('canvas-text')) return;
            
            selectedElement.style.height = height + 'px';
            document.getElementById('text-height-value').textContent = height + 'px';
            
            // 리사이즈 핸들 업데이트
            if (typeof updateResizeHandles === 'function') {
                updateResizeHandles();
            }
            
            saveCanvasState();
        }
        
        function updateTextPosition() {
            if (!selectedElement || !selectedElement.classList.contains('canvas-text')) return;
            
            const x = document.getElementById('text-x').value;
            const y = document.getElementById('text-y').value;
            
            selectedElement.style.left = x + 'px';
            selectedElement.style.top = y + 'px';
            
            // 리사이즈 핸들 업데이트
            if (typeof updateResizeHandles === 'function') {
                updateResizeHandles();
            }
            
            saveCanvasState();
        }
        
        // ========== 🔥 이미지 위치 조절 함수 (새로 추가) ==========
        function updateImageWidth(width) {
            if (!selectedElement || !selectedElement.classList.contains('canvas-image')) return;
            
            selectedElement.style.width = width + 'px';
            document.getElementById('image-width-value').textContent = width + 'px';
            
            // 리사이즈 핸들 업데이트
            if (typeof updateResizeHandles === 'function') {
                updateResizeHandles();
            }
            
            saveCanvasState();
        }
        
        function updateImageHeight(height) {
            if (!selectedElement || !selectedElement.classList.contains('canvas-image')) return;
            
            selectedElement.style.height = height + 'px';
            document.getElementById('image-height-value').textContent = height + 'px';
            
            // 리사이즈 핸들 업데이트
            if (typeof updateResizeHandles === 'function') {
                updateResizeHandles();
            }
            
            saveCanvasState();
        }
        
        function updateImagePosition() {
            if (!selectedElement || !selectedElement.classList.contains('canvas-image')) return;
            
            const x = document.getElementById('image-x').value;
            const y = document.getElementById('image-y').value;
            
            selectedElement.style.left = x + 'px';
            selectedElement.style.top = y + 'px';
            
            // 리사이즈 핸들 업데이트
            if (typeof updateResizeHandles === 'function') {
                updateResizeHandles();
            }
            
            saveCanvasState();
        }
        
        // ========== 🔥 도형 크기/위치 조절 함수들 (새로 추가) ==========
        function updateShapeWidth(width) {
            if (!selectedElement || !selectedElement.classList.contains('canvas-shape')) return;
            
            selectedElement.style.width = width + 'px';
            document.getElementById('shape-width-value').textContent = width + 'px';
            
            // 리사이즈 핸들 업데이트
            if (typeof updateResizeHandles === 'function') {
                updateResizeHandles();
            }
            
            saveCanvasState();
        }
        
        function updateShapeHeight(height) {
            if (!selectedElement || !selectedElement.classList.contains('canvas-shape')) return;
            
            selectedElement.style.height = height + 'px';
            document.getElementById('shape-height-value').textContent = height + 'px';
            
            // 리사이즈 핸들 업데이트
            if (typeof updateResizeHandles === 'function') {
                updateResizeHandles();
            }
            
            saveCanvasState();
        }
        
        function updateShapePosition() {
            if (!selectedElement || !selectedElement.classList.contains('canvas-shape')) return;
            
            const x = document.getElementById('shape-x').value;
            const y = document.getElementById('shape-y').value;
            
            selectedElement.style.left = x + 'px';
            selectedElement.style.top = y + 'px';
            
            // 리사이즈 핸들 업데이트
            if (typeof updateResizeHandles === 'function') {
                updateResizeHandles();
            }
            
            saveCanvasState();
        }
        
        function updateShapeBgColor(color) {
            if (!selectedElement || !selectedElement.classList.contains('canvas-shape')) return;
            selectedElement.style.backgroundColor = color;
            saveCanvasState();
        }
        
        function updateShapeBorderColor(color) {
            if (!selectedElement || !selectedElement.classList.contains('canvas-shape')) return;
            selectedElement.style.borderColor = color;
            saveCanvasState();
        }
        
        function updateShapeBorderWidth(width) {
            if (!selectedElement || !selectedElement.classList.contains('canvas-shape')) return;
            selectedElement.style.borderWidth = width + 'px';
            selectedElement.style.borderStyle = width > 0 ? 'solid' : 'none';
            document.getElementById('shape-border-width-value').textContent = width + 'px';
            saveCanvasState();
        }
        
        function updateShapeOpacity(opacity) {
            if (!selectedElement || !selectedElement.classList.contains('canvas-shape')) return;
            selectedElement.style.opacity = opacity / 100;
            document.getElementById('shape-opacity-value').textContent = opacity + '%';
            saveCanvasState();
        }
        
        function updateShapeRotation(angle) {
            if (!selectedElement || !selectedElement.classList.contains('canvas-shape')) return;
            selectedElement.style.transform = `rotate(${angle}deg)`;
            document.getElementById('shape-rotation-value').textContent = angle + '°';
            
            // 리사이즈 핸들 업데이트
            if (typeof updateResizeHandles === 'function') {
                updateResizeHandles();
            }
            
            saveCanvasState();
        }
        
        function rotateShape(angle) {
            if (!selectedElement || !selectedElement.classList.contains('canvas-shape')) return;
            
            const currentRotation = parseInt(document.getElementById('shape-rotation').value) || 0;
            const newRotation = (currentRotation + angle) % 360;
            
            document.getElementById('shape-rotation').value = newRotation;
            updateShapeRotation(newRotation);
        }
        
        function toggleShapeAspectRatio() {
            // 비율 고정 기능 구현
            const btn = document.getElementById('shape-lock-ratio-btn');
            btn.classList.toggle('active');
            
            if (btn.classList.contains('active')) {
                btn.innerHTML = '🔓 비율해제';
                btn.style.background = '#007bff';
            } else {
                btn.innerHTML = '🔒 비율고정';
                btn.style.background = '#555';
            }
        }
        
        function resetShapeSize() {
            if (!selectedElement || !selectedElement.classList.contains('canvas-shape')) return;
            
            selectedElement.style.width = '120px';
            selectedElement.style.height = '80px';
            
            document.getElementById('shape-width').value = 120;
            document.getElementById('shape-height').value = 80;
            document.getElementById('shape-width-value').textContent = '120px';
            document.getElementById('shape-height-value').textContent = '80px';
            
            // 리사이즈 핸들 업데이트
            if (typeof updateResizeHandles === 'function') {
                updateResizeHandles();
            }
            
            saveCanvasState();
        }

        // ========== 오디오 관련 함수들 (새로 추가) ==========
        
        // 음성파일 업로드 함수
        function uploadAudioFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            console.log('음성파일 업로드:', file.name);
            
            // 파일을 처리하여 목록에 추가
            const audioList = document.getElementById('uploaded-audio-list');
            if (audioList) {
                const audioItem = document.createElement('div');
                audioItem.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px; margin: 5px 0; padding: 5px; background: #404040; border-radius: 4px;">
                        <span style="color: white; font-size: 11px; flex: 1;">${file.name}</span>
                        <button onclick="playAudio('${file.name}')" style="padding: 2px 6px; background: #007bff; color: white; border: none; border-radius: 3px; font-size: 10px;">재생</button>
                        <button onclick="addAudioToCanvas('${file.name}')" style="padding: 2px 6px; background: #28a745; color: white; border: none; border-radius: 3px; font-size: 10px;">추가</button>
                    </div>
                `;
                audioList.appendChild(audioItem);
            }
        }
        
        // 효과음 업로드 함수
        function uploadEffectSounds(input) {
            const files = Array.from(input.files);
            if (!files.length) return;
            
            console.log('효과음 업로드:', files.map(f => f.name));
            
            // 파일들을 처리하여 목록에 추가
            const effectList = document.getElementById('effect-sounds-list');
            if (effectList) {
                files.forEach(file => {
                    const effectItem = document.createElement('div');
                    effectItem.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 8px; margin: 5px 0; padding: 5px; background: #404040; border-radius: 4px;">
                            <span style="color: white; font-size: 11px; flex: 1;">🔊 ${file.name}</span>
                            <button onclick="playEffect('${file.name}')" style="padding: 2px 6px; background: #007bff; color: white; border: none; border-radius: 3px; font-size: 10px;">재생</button>
                            <button onclick="addEffectToCanvas('${file.name}')" style="padding: 2px 6px; background: #28a745; color: white; border: none; border-radius: 3px; font-size: 10px;">사용</button>
                        </div>
                    `;
                    effectList.appendChild(effectItem);
                });
            }
        }
        
        // 무료 효과음 검색 함수
        function searchFreeSFX() {
            const query = document.getElementById('sfx-search').value.trim();
            if (!query) {
                alert('검색어를 입력해주세요.');
                return;
            }
            
            console.log('무료 효과음 검색:', query);
            
            // API 연결 예정 - 임시로 가짜 결과 표시
            const resultsContainer = document.getElementById('free-sfx-results');
            if (resultsContainer) {
                resultsContainer.innerHTML = `
                    <div style="color: #ccc; font-size: 11px; text-align: center; margin: 10px 0;">
                        "${query}" 검색 결과 (API 연결 예정)
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; margin: 5px 0; padding: 5px; background: #404040; border-radius: 4px;">
                        <span style="color: white; font-size: 11px; flex: 1;">🎵 ${query}_sound_01.wav</span>
                        <button onclick="playFreeSFX('sample1')" style="padding: 2px 6px; background: #007bff; color: white; border: none; border-radius: 3px; font-size: 10px;">재생</button>
                        <button onclick="downloadFreeSFX('sample1')" style="padding: 2px 6px; background: #28a745; color: white; border: none; border-radius: 3px; font-size: 10px;">다운</button>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; margin: 5px 0; padding: 5px; background: #404040; border-radius: 4px;">
                        <span style="color: white; font-size: 11px; flex: 1;">🎵 ${query}_sound_02.wav</span>
                        <button onclick="playFreeSFX('sample2')" style="padding: 2px 6px; background: #007bff; color: white; border: none; border-radius: 3px; font-size: 10px;">재생</button>
                        <button onclick="downloadFreeSFX('sample2')" style="padding: 2px 6px; background: #28a745; color: white; border: none; border-radius: 3px; font-size: 10px;">다운</button>
                    </div>
                `;
            }
        }
        
        // 녹음 예정 메시지
        function showRecordingMessage() {
            alert('🎙️ 음성 녹음 기능은 구현예정입니다.\n\n향후 업데이트에서 다음 기능들이 추가될 예정입니다:\n- 실시간 음성 녹음\n- 마이크 음성 입력\n- 녹음 파일 편집\n- 음성 품질 조절');
        }
        
        // 오디오 재생 관련 함수들
        function playAudio(fileName) {
            console.log('음성 재생:', fileName);
            // 실제 재생 기능 구현 예정
        }
        
        function addAudioToCanvas(fileName) {
            console.log('캔버스에 음성 추가:', fileName);
            // 캔버스에 음성 트랙 추가 기능 구현 예정
        }
        
        function playEffect(fileName) {
            console.log('효과음 재생:', fileName);
            // 실제 재생 기능 구현 예정
        }
        
        function addEffectToCanvas(fileName) {
            console.log('캔버스에 효과음 추가:', fileName);
            // 캔버스에 효과음 추가 기능 구현 예정
        }
        
        function playFreeSFX(sampleId) {
            console.log('무료 효과음 재생:', sampleId);
            // 실제 재생 기능 구현 예정
        }
        
        function downloadFreeSFX(sampleId) {
            console.log('무료 효과음 다운로드:', sampleId);
            // 실제 다운로드 기능 구현 예정
        }

        // ========== 네비게이션 기능 업데이트 ==========
        function goHome() {
            window.location.href = 'index.html';
        }
        
        function openAdmin() {
            // 관리자 페이지로 이동 또는 관리자 패널 열기
            window.open('admin.html', '_blank');
        }
        
        function saveProject() {
            // 현재 프로젝트 상태 저장
            const projectData = {
                name: document.getElementById('project-title').textContent,
                canvas: document.getElementById('canvas').innerHTML,
                timestamp: new Date().toISOString(),
                elements: []
            };
            
            // 캔버스 요소들 수집
            const elements = document.querySelectorAll('.canvas-element');
            elements.forEach((element, index) => {
                projectData.elements.push({
                    id: element.id,
                    type: element.classList.contains('canvas-text') ? 'text' : 
                          element.classList.contains('canvas-image') ? 'image' : 
                          element.classList.contains('canvas-shape') ? 'shape' : 'unknown',
                    style: element.style.cssText,
                    content: element.innerHTML || element.src,
                    position: {
                        left: element.style.left,
                        top: element.style.top
                    }
                });
            });
            
            // localStorage에 저장
            localStorage.setItem('currentProject', JSON.stringify(projectData));
            
            alert('✅ 프로젝트가 저장되었습니다!\n\n저장 시간: ' + new Date().toLocaleString());
            console.log('💾 프로젝트 저장 완료:', projectData);
        }

        // ========== 플레이어 기능 ==========
        let currentMode = 'edit';
        let isPlaying = false;
        let currentTime = 0;
        let totalDuration = 60;
        let playInterval = null;
        let timelineElements = [];
        
        // 편집 모드로 전환
        function switchToEditMode() {
            currentMode = 'edit';
            
            // 재생 중이면 정지
            if (isPlaying) {
                stopPlayback();
            }
            
            // UI 업데이트
            document.getElementById('edit-mode-btn').classList.add('active');
            document.getElementById('player-mode-btn').classList.remove('active');
            document.getElementById('player-controls').style.display = 'none';
            
            // 캔버스 스타일 복구
            const canvas = document.getElementById('canvas');
            canvas.classList.remove('canvas-player-mode');
            
            // 모든 요소 표시
            const elements = canvas.querySelectorAll('.canvas-element');
            elements.forEach(element => {
                element.style.display = '';
                element.style.opacity = '';
            });
            
            console.log('✏️ 편집 모드로 전환');
        }
        
        // 플레이어 모드로 전환
        function switchToPlayerMode() {
            currentMode = 'player';
            
            // UI 업데이트
            document.getElementById('edit-mode-btn').classList.remove('active');
            document.getElementById('player-mode-btn').classList.add('active');
            document.getElementById('player-controls').style.display = 'flex';
            
            // 캔버스를 플레이어용으로 설정
            const canvas = document.getElementById('canvas');
            canvas.classList.add('canvas-player-mode');
            
            // 타임라인 요소들 준비
            prepareTimelineElements();
            
            // 시작 시점으로 리셋
            seekTo(0);
            
            console.log('▶️ 플레이어 모드로 전환');
        }
        
        // 타임라인 요소들 준비
        function prepareTimelineElements() {
            const canvas = document.getElementById('canvas');
            const elements = canvas.querySelectorAll('.canvas-element:not(.canvas-background-template)');
            
            timelineElements = [];
            
            elements.forEach((element, index) => {
                const timelineItem = {
                    element: element,
                    startTime: index * 3, // 3초씩 간격
                    endTime: totalDuration,
                    animation: 'fadeIn',
                    duration: 0.5
                };
                
                timelineElements.push(timelineItem);
                
                // 초기에는 모든 요소 숨김
                element.style.display = 'none';
                element.style.opacity = '0';
            });
            
            console.log(`📋 타임라인 요소 ${timelineElements.length}개 준비 완료`);
        }
        
        // 재생/일시정지 토글
        function togglePlayPause() {
            if (isPlaying) {
                pausePlayback();
            } else {
                startPlayback();
            }
        }
        
        // 재생 시작
        function startPlayback() {
            if (currentMode !== 'player') return;
            
            isPlaying = true;
            document.getElementById('play-pause-btn').innerHTML = '⏸️';
            
            playInterval = setInterval(() => {
                currentTime += 1/30; // 30fps
                
                if (currentTime >= totalDuration) {
                    const loopBtn = document.getElementById('loop-btn');
                    if (loopBtn && loopBtn.classList.contains('active')) {
                        seekTo(0);
                    } else {
                        stopPlayback();
                    }
                    return;
                }
                
                updateTimeline();
                updateTimeDisplay();
                updateTimelineSlider();
                
            }, 1000/30);
            
            console.log('▶️ 재생 시작');
        }
        
        // 재생 일시정지
        function pausePlayback() {
            isPlaying = false;
            document.getElementById('play-pause-btn').innerHTML = '▶️';
            
            if (playInterval) {
                clearInterval(playInterval);
                playInterval = null;
            }
            
            console.log('⏸️ 재생 일시정지');
        }
        
        // 재생 정지
        function stopPlayback() {
            pausePlayback();
            seekTo(0);
            console.log('⏹️ 재생 정지');
        }
        
        // 특정 시점으로 이동
        function seekTo(time) {
            currentTime = Math.max(0, Math.min(totalDuration, time));
            updateTimeline();
            updateTimeDisplay();
            updateTimelineSlider();
        }
        
        // 타임라인 업데이트
        function updateTimeline() {
            timelineElements.forEach(item => {
                const { element, startTime, endTime, animation, duration } = item;
                
                if (currentTime >= startTime && currentTime <= endTime) {
                    if (element.style.display === 'none') {
                        element.style.display = '';
                        animateElement(element, animation, duration);
                    }
                } else {
                    element.style.display = 'none';
                    element.style.opacity = '0';
                }
            });
        }
        
        // 요소 애니메이션
        function animateElement(element, animationType, duration) {
            element.style.transition = `all ${duration}s ease`;
            
            switch(animationType) {
                case 'fadeIn':
                    element.style.opacity = '0';
                    setTimeout(() => {
                        element.style.opacity = '1';
                    }, 10);
                    break;
                default:
                    element.style.opacity = '1';
            }
        }
        
        // 시간 표시 업데이트
        function updateTimeDisplay() {
            const current = formatTime(currentTime);
            const total = formatTime(totalDuration);
            document.getElementById('time-display').innerHTML = `${current} / ${total}`;
        }
        
        // 타임라인 슬라이더 업데이트
        function updateTimelineSlider() {
            document.getElementById('timeline-slider').value = currentTime;
        }
        
        // 시간 포맷팅
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // 재생 속도 변경
        function changePlaybackSpeed(speed) {
            console.log(`⚡ 재생 속도: ${speed}x`);
        }
        
        // 볼륨 조절
        function changeVolume(volume) {
            document.getElementById('volume-value').innerHTML = `${volume}%`;
            console.log(`🔊 볼륨: ${volume}%`);
        }
        
        // 반복 재생 토글
        function toggleLoop() {
            const loopBtn = document.getElementById('loop-btn');
            loopBtn.classList.toggle('active');
            
            if (loopBtn.classList.contains('active')) {
                loopBtn.style.background = '#007bff';
                loopBtn.innerHTML = '🔄 반복 ON';
            } else {
                loopBtn.style.background = '#555';
                loopBtn.innerHTML = '🔄 반복';
            }
        }
        
        // 전체화면 토글
        function toggleFullscreen() {
            const canvas = document.getElementById('canvas');
            
            if (!document.fullscreenElement) {
                canvas.requestFullscreen().then(() => {
                    console.log('⛶ 전체화면 모드');
                }).catch(err => {
                    console.error('전체화면 실패:', err);
                });
            } else {
                document.exitFullscreen().then(() => {
                    console.log('⛷ 전체화면 해제');
                }).catch(err => {
                    console.error('전체화면 해제 실패:', err);
                });
            }
        }
        
        // 동영상 렌더링
        function renderVideo() {
            if (!confirm('현재 편집 내용을 동영상으로 렌더링하시겠습니까?')) {
                return;
            }
            
            const renderBtn = event.target;
            const originalText = renderBtn.innerHTML;
            renderBtn.innerHTML = '🎬 렌더링 중...';
            renderBtn.disabled = true;
            
            setTimeout(() => {
                alert(`🎉 렌더링 완료!

출력 설정:
- 해상도: 1080x1920 (세로형 쇼츠)  
- 포맷: MP4 (H.264)
- 프레임율: 30fps
- 길이: ${formatTime(totalDuration)}

파일이 다운로드 폴더에 저장됩니다.`);
                
                renderBtn.innerHTML = originalText;
                renderBtn.disabled = false;
                
                console.log('🎬 동영상 렌더링 완료');
            }, 3000);
        }
        
        // ========== 템플릿 및 기타 로드 ==========
        
        // 오디오 패널 로드
        fetch('templates/audio-panel.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('audio-sources').innerHTML = html;
                console.log('🎵 오디오 패널 로드 완료');
            })
            .catch(error => console.error('오디오 패널 로드 실패:', error));

        // 텍스트 편집기 로드
        fetch('templates/text-editor.html')
            .then(response => response.text())
            .then(html => {
                const pptContent = document.getElementById('ppt-content');
                if (pptContent) {
                    pptContent.insertAdjacentHTML('beforeend', html);
                }
            })
            .catch(error => console.error('텍스트 편집기 로드 실패:', error));

        // 템플릿 패널 로드
        fetch('templates/template-panel.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('template-sources').innerHTML = html;
                console.log('🎨 템플릿 패널 로드 완료');
            })
            .catch(error => console.error('템플릿 패널 로드 실패:', error));
            
        // 저장된 프로젝트 불러오기
        function loadProject() {
            const saved = localStorage.getItem('currentProject');
            if (saved) {
                const projectData = JSON.parse(saved);
                
                // 프로젝트 제목 복원
                document.getElementById('project-title').textContent = projectData.name;
                
                // 캔버스 초기화
                const canvas = document.getElementById('canvas');
                canvas.innerHTML = '';
                
                // 요소들 복원
                projectData.elements.forEach(elementData => {
                    let element;
                    
                    if (elementData.type === 'text') {
                        element = document.createElement('div');
                        element.className = 'canvas-element canvas-text';
                        element.innerHTML = elementData.content;
                        element.contentEditable = true;
                    } else if (elementData.type === 'image') {
                        element = document.createElement('img');
                        element.className = 'canvas-element canvas-image';
                        element.src = elementData.content;
                    } else if (elementData.type === 'shape') {
                        element = document.createElement('div');
                        element.className = 'canvas-element canvas-shape';
                    }
                    
                    if (element) {
                        element.id = elementData.id;
                        element.style.cssText = elementData.style;
                        element.style.left = elementData.position.left;
                        element.style.top = elementData.position.top;
                        element.style.position = 'absolute';
                        element.style.cursor = 'move';
                        
                        element.onclick = function() {
                            selectElement(this);
                        };
                        
                        canvas.appendChild(element);
                    }
                });
                
                console.log(`📂 프로젝트 불러오기 완료: ${projectData.elements.length}개 요소`);
                
                // 캔버스 상태도 함께 복원
                const canvasState = localStorage.getItem('canvas_state');
                if (canvasState) {
                    try {
                        const parsed = JSON.parse(canvasState);
                        parsed.elements.forEach(elementData => {
                            if (elementData.type === 'background-template') {
                                const bgElement = document.createElement('img');
                                bgElement.className = elementData.className;
                                bgElement.id = elementData.id;
                                bgElement.src = elementData.content;
                                bgElement.alt = elementData.attributes.alt || 'Background Template';
                                
                                // 배경 템플릿 고정 스타일
                                bgElement.style.cssText = `
                                    position: absolute;
                                    left: 0px;
                                    top: 0px;
                                    width: 100%;
                                    height: 100%;
                                    object-fit: cover;
                                    z-index: 3;
                                    pointer-events: none;
                                `;
                                
                                // 이미지 로드 실패시 제거
                                bgElement.onerror = function() {
                                    console.log('템플릿 이미지 로드 실패 - 요소 제거');
                                    this.remove();
                                };
                                
                                canvas.insertBefore(bgElement, canvas.firstChild);
                            }
                        });
                    } catch (error) {
                        console.error('캔버스 상태 복원 중 오류:', error);
                    }
                }
                
                return true;
            }
            return false;
        }
        
        // 페이지 로드 완료 시 초기화 및 자동 불러오기
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎬 편집기 로드 완료 - 플레이어 기능 내장, 크기 조절 기능 추가, AI 모델 선택 UI 포함, 오디오 패널 분리');
            
            // 저장된 프로젝트 자동 불러오기
            if (loadProject()) {
                console.log('✅ 저장된 프로젝트 자동 복원됨');
            }
        });
    </script>
</body>
</html>